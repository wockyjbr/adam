"use strict";angular.module("simpleAuctionFrontendApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"about"}).otherwise({redirectTo:"/"})}]),angular.module("simpleAuctionFrontendApp").controller("MainCtrl",["$scope","$uibModal","userService","auctionService",function(a,b,c,d){function e(a){var c=a;b.open({ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"views/info.html",controller:["$scope",function(a){this.cancel=function(){a.$dismiss("cancel")},this.infoMessage=c}],controllerAs:"$ctrl"})}a.pagination={currentPage:1,totalItems:0,totalPages:0},a.currentState="all",a.currentUser={id:"",login:""},a.connected=!1,a.loginMessage="";var f="";a.getAuctions=function(){return a.currentState="all",d.getAuctions(f,a.pagination.currentPage-1).then(function(b){a.auctions=b.data.content,a.pagination.totalPages=b.data.totalPages,a.pagination.totalItems=b.data.totalElements,a.pagination.currentPage=b.data.number+1,a.connected=!0})},a.getOpenedAuctions=function(){return a.currentState="opened",d.getOpenedAuctions(f,a.pagination.currentPage-1).then(function(b){a.auctions=b.data.content,a.pagination.totalPages=b.data.totalPages,a.pagination.totalItems=b.data.totalElements,a.pagination.currentPage=b.data.number+1})},a.getClosedAuctions=function(){return a.currentState="closed",d.getClosedAuctions(f,a.pagination.currentPage-1).then(function(b){a.auctions=b.data.content,a.pagination.totalPages=b.data.totalPages,a.pagination.totalItems=b.data.totalElements,a.pagination.currentPage=b.data.number+1})},a.addAuction=function(){var a=this;b.open({ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"views/auction.html",controller:["$scope",function(b){var c=this;c.cancel=function(){b.$dismiss("cancel")},c.addAuction=function(){var b={title:c.auctionTitle,price:c.auctionPrice,description:c.auctionDescription,ownerId:a.currentUser.id,validity:c.auctionValidity};return d.addAuction(f,b).then(function(b){c.cancel(),a.refreshAuctions()},function(a){var b="";a.data.errors.forEach(function(a){b+=a.field.charAt(0).toUpperCase()+a.field.slice(1)+": "+a.defaultMessage+". "}),c.validationError="Some of the fields are invalid: "+b})}}],controllerAs:"$ctrl"})},a.login=function(){var b={login:a.userLogin,password:a.userPassword};return c.userLogin(b).then(function(b){null!=b.data&&"Success"==b.data.Type?(a.connected=!0,a.currentUser.login=b.data.UserLogin,a.currentUser.id=b.data.UserID,a.loginMessage="Logged as: "+b.data.UserLogin,f=b.data.AuthKey,a.getAuctions()):(a.connected=!1,f="",a.loginMessage="Wrong login and/or password.")})},a.logout=function(){a.loginMessage="",a.connected=!1},a.register=function(){b.open({ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"views/register.html",controller:["$scope",function(a){function b(a,b){return d.userPassword&&d.userPassword==d.userPasswordRepeat}var d=this;d.cancel=function(){a.$dismiss("cancel")},d.addUser=function(){if(b(d.userPassword,d.userPasswordRepeat)){var a={firstName:d.userFirstName,lastName:d.userLastName,login:d.userLogin,password:d.userPassword};return c.addUser(a).then(function(a){d.cancel(),e(a.data.firstName?"New user successfully registered.":"Failed to register new user.")},function(a){var b="";a.data.errors.forEach(function(a){b+=a.field.charAt(0).toUpperCase()+a.field.slice(1)+": "+a.defaultMessage+". "}),d.validationError="Some of the fields are invalid: "+b})}d.validationError="Some of the fields are invalid: Password and Password Repeat"}}],controllerAs:"$ctrl"})},a.bid=function(b){return d.bidAuction(f,b,a.currentUser).then(function(b){b.data.price&&null!=b.data.price?a.refreshAuctions():e("You cannot bid this item. You are already the top bidder.")})},a.close=function(b){return d.closeAuction(f,b,a.currentUser).then(function(b){b.data.price&&null!=b.data.price?a.refreshAuctions():e("You cannot close this auction.")})},a.pageChanged=function(){a.refreshAuctions()},a.refreshAuctions=function(){console.log("Refreshed"),"opened"==a.currentState?a.getOpenedAuctions():"closed"==a.currentState?a.getClosedAuctions():a.getAuctions()},a.showBidders=function(a){return d.getBidders(f,a).then(function(a){var b="";a.data.forEach(function(a){b+=a.login+", "}),b=b.slice(0,-2),e("Bidding history: "+b+".")})},a.calculateRemainingDays=function(a){var b=new Date,c=Math.round(Math.abs((b.getTime()-a)/864e5));return c+" days"}}]),angular.module("simpleAuctionFrontendApp").controller("AboutCtrl",function(){}),angular.module("simpleAuctionFrontendApp").service("userService",["$http",function(a){var b="http://localhost:8080";return{userLogin:function(c){return a.post(b+"/user/login",c)},addUser:function(c){return a.post(b+"/user",c)},getUsers:function(c){var d={Authorization:"Basic user:"+c};return a.get(b+"/users",{headers:d})}}}]),angular.module("simpleAuctionFrontendApp").service("auctionService",["$http",function(a){var b="http://localhost:8080";return{getAuctions:function(c,d){var e={Authorization:"Basic user:"+c};return a.get(b+"/auctions?page="+d,{headers:e})},getOpenedAuctions:function(c,d){var e={Authorization:"Basic user:"+c};return a.get(b+"/auctions/opened?page="+d,{headers:e})},getClosedAuctions:function(c,d){var e={Authorization:"Basic user:"+c};return a.get(b+"/auctions/closed?page="+d,{headers:e})},getBidders:function(c,d){var e={Authorization:"Basic user:"+c};return a.get(b+"/auction/"+d+"/bidders",{headers:e})},bidAuction:function(c,d,e){var f={Authorization:"Basic user:"+c};return a.put(b+"/auction/"+d+"/bid",e,{headers:f})},closeAuction:function(c,d,e){var f={Authorization:"Basic user:"+c};return a.put(b+"/auction/"+d+"/close",e,{headers:f})},addAuction:function(c,d){var e={Authorization:"Basic user:"+c};return a.post(b+"/auction",d,{headers:e})}}}]),angular.module("simpleAuctionFrontendApp").run(["$templateCache",function(a){a.put("views/about.html",'<p>Coding task for UBS. Author: <a href="mailto:adam.czyszczon@gmail.com">Adam Czyszczo≈Ñ</a></p>'),a.put("views/auction.html",'<div class="modal-header"> <h3 class="modal-title" id="modal-title">Add Auction</h3> </div> <div class="modal-body" id="modal-body"> <p class="text-danger">{{$ctrl.validationError}}</p> <form> <div class="form-group"> <label for="auctionTitle">Title</label> <input type="text" class="form-control" id="auctionTitle" aria-describedby="titleHelp" placeholder="Enter title" maxlength="30" ng-model="$ctrl.auctionTitle"> <small id="titleHelp" class="form-text text-muted">Title of the auction. From 2 to 30 characters.</small> </div> <div class="form-group"> <label for="auctionPrice">Price</label> <input type="number" class="form-control" id="auctionPrice" aria-describedby="priceHelp" placeholder="Enter price" min="1" max="90000000000000" ng-model="$ctrl.auctionPrice"> <small id="priceHelp" class="form-text text-muted">Price of the auction. Miniumum value 1.</small> </div> <div class="form-group"> <label for="auctionDescription">Description</label> <input type="text" class="form-control" id="auctionDescription" aria-describedby="descriptionHelp" maxlength="250" placeholder="Enter description" ng-model="$ctrl.auctionDescription"> <small id="descriptionHelp" class="form-text text-muted">Description of the auction. Max 250 characters.</small> </div> <div class="form-group"> <label for="auctionValidity">Validity</label> <input type="number" class="form-control" id="auctionValidity" aria-describedby="validityHelp" placeholder="Enter validity in days" min="1" max="30" ng-model="$ctrl.auctionValidity"> <small id="validityHelp" class="form-text text-muted">Number of days this auction will be valid. From 1 to 30 days.</small> </div> </form> </div> <div class="modal-footer"> <button class="btn btn-primary" type="button" ng-click="$ctrl.addAuction()">Add</button> <button class="btn btn-warning" type="button" ng-click="$ctrl.cancel()">Cancel</button> </div>'),a.put("views/info.html",'<div class="modal-header"> <h3 class="modal-title" id="modal-title">Information</h3> </div> <div class="modal-body" id="modal-body"> <p><span class="glyphicon glyphicon-info-sign"></span> {{$ctrl.infoMessage}} </p> </div> <div class="modal-footer"> <button class="btn btn-warning" type="button" ng-click="$ctrl.cancel()">Ok, thanks</button> </div>'),a.put("views/main.html",'<div class="jumbotron"> <p class="lead" ng-show="!connected"> Please login to see auctions. If you don\'t have an account please register. </p> <p ng-show="!connected"><input type="text" maxlength="20" ng-model="userLogin" placeholder="Type your login name"> </p><p ng-show="!connected"><input type="password" maxlength="20" ng-model="userPassword" placeholder="Type your password" ng-keyup="$event.keyCode == 13 && login()"> <div class="inline"> <a ng-show="!connected" class="btn btn-lg btn-success" ng-click="login()">Login <span class="glyphicon glyphicon-flash"></span></a> <a ng-show="connected" class="btn btn-lg btn-danger" ng-click="logout()">Logout <span class="glyphicon glyphicon-off"></span></a> <a ng-show="!connected" class="btn btn-lg btn-primary" ng-click="register()">Register <span class="glyphicon glyphicon-user"></span></a> </div> </p><p ng-class="connected ? \'text-info\' : \'text-danger\'">{{loginMessage}}</p> </div> <div class="row marketing" ng-show="connected"> <div> <div class="panel panel-default panel-table"> <div class="panel-heading"> <div class="row"> <div class="col col-xs-6"> <h3 class="panel-title">Current Auctions <small> <span class="state-filter" ng-class="currentState == \'all\' ? \'active\' : \'\'" ng-click="getAuctions()">All</span> <span class="state-filter" ng-class="currentState == \'opened\' ? \'active\' : \'\'" ng-click="getOpenedAuctions()">Opened</span> <span class="state-filter" ng-class="currentState == \'closed\' ? \'active\' : \'\'" ng-click="getClosedAuctions()">Closed</span> </small> </h3><span class="glyphicon glyphicon-info-refresh"></span> </div> <div class="col col-xs-6 text-right"> <button type="button" class="btn btn-sm btn-primary" ng-click="refreshAuctions()">Refresh <span class="glyphicon glyphicon-refresh"></span></button> <button type="button" class="btn btn-sm btn-success btn-create" ng-click="addAuction()">New Auction <span class="glyphicon glyphicon-plus"></span></button> </div> </div> </div> <div class="panel-body"> <table class="table table-striped table-bordered table-list"> <thead> <tr> <th style="min-width:105px"><span class="glyphicon glyphicon-cog"></span></th> <th>Title</th> <th>Description</th> <th>Owner</th> <th>Top bidder</th> <th>Price</th> <th>{{currentState == \'closed\' ? \'Closed\' : \'Started\'}}</th> <th>Valid until</th> </tr> </thead> <tbody> <tr ng-repeat="auction in auctions"> <td align="center"> <a class="btn btn-success" alt="Bid this auction" ng-show="auction.owner.login != currentUser.login && auction.isOpen" ng-click="bid(auction.id)"><span class="glyphicon glyphicon-usd"></span></a> <a class="btn btn-danger" alt="Finish this auction" ng-show="auction.owner.login == currentUser.login && auction.isOpen" ng-click="close(auction.id)"><span class="glyphicon glyphicon-eye-close"></span></a> </td> <td>{{auction.title}}</td> <td>{{auction.description}}</td> <td>{{auction.owner.login}}</td> <td>{{auction.topBidder ? auction.topBidder.login : \'None\'}} <span class="text-primary show-more" ng-show="auction.topBidder" ng-click="showBidders(auction.id)">(more)</span></td> <td><strong>{{auction.price | number : 2}}</strong></td> <td><span class="small">{{currentState == \'closed\' ? auction.closeDate : auction.openDate | date: \'yyyy-MM-dd hh:mm:ss\'}}</span></td> <td><strong>{{!auction.isOpen ? \'Closed\' : calculateRemainingDays(auction.closeDate)}}</strong> <span class="small">{{auction.closeDate | date: \'yyyy-MM-dd hh:mm:ss\'}}</span></td> </tr> </tbody> </table> </div> <div class="panel-footer"> <div class="row"> <div class="col col-xs-5">Page {{pagination.currentPage}} of {{pagination.totalPages}} (showing {{auctions.length}} from {{pagination.totalItems}} total)</div> <div class="col col-xs-7"> <ul uib-pagination total-items="pagination.totalItems" ng-model="pagination.currentPage" ng-change="pageChanged()" class="pagination hidden-xs pull-right"></ul> </div> </div> </div> </div> </div></div>'),a.put("views/register.html",'<div class="modal-header"> <h3 class="modal-title" id="modal-title">Add User</h3> </div> <div class="modal-body" id="modal-body"> <p class="text-danger">{{$ctrl.validationError}}</p> <form> <div class="form-group"> <label for="userFirstName">First name</label> <input type="text" class="form-control" id="userFirstName" aria-describedby="firstNametHelp" placeholder="Enter first name" maxlength="30" ng-model="$ctrl.userFirstName"> <small id="firstNametHelp" class="form-text text-muted">From 2 to 30 characters.</small> </div> <div class="form-group"> <label for="userLastName">Last name</label> <input type="text" class="form-control" id="userLastName" aria-describedby="lastNameHelp" placeholder="Enter last name" maxlength="50" ng-model="$ctrl.userLastName"> <small id="lastNameHelp" class="form-text text-muted">From 2 to 50 characters.</small> </div> <div class="form-group"> <label for="userLogin">Login name</label> <input type="text" class="form-control" id="userLogin" aria-describedby="loginHelp" placeholder="Enter login" maxlength="30" ng-model="$ctrl.userLogin"> <small id="loginHelp" class="form-text text-muted">From 2 to 30 characters.</small> </div> <div class="form-group"> <label for="userPassword">Password</label> <input type="password" class="form-control" id="userPassword" aria-describedby="passwordHelp" placeholder="Enter password" maxlength="30" ng-model="$ctrl.userPassword"> <small id="passwordHelp" class="form-text text-muted">From 3 to 30 characters.</small> </div> <div class="form-group"> <label for="userPasswordRepeat">Password repeat</label> <input type="password" class="form-control" id="userPasswordRepeat" aria-describedby="passwordRepeatHelp" placeholder="Repeat password" maxlength="30" ng-model="$ctrl.userPasswordRepeat"> <small id="passwordRepeatHelp" class="form-text text-muted">Repeat password.</small> </div> </form> </div> <div class="modal-footer"> <button class="btn btn-primary" type="button" ng-click="$ctrl.addUser()">Add</button> <button class="btn btn-warning" type="button" ng-click="$ctrl.cancel()">Cancel</button> </div>')}]);